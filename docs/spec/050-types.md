# 型の各論

WIP

型の種類やそれぞれの型がとりうる値などを定める。

## 整数型

組み込みの整数型は特定のビット幅を持ち、2の補数で表現される。isize, usize のビット幅はコンパイル対象によって決まり、ポインタのビット幅に等しい。

| 名前   | ビット幅   | 意味    |
|:------|----------:|:--------------|
| i8    | 8         | 符号つき整数  |
| i16   | 16        | 符号つき整数  |
| i32   | 32        | 符号つき整数  |
| i64   | 64        | 符号つき整数  |
| isize | ptr       | 符号つき整数  |
| u8    | 8         | 符号なし整数  |
| u16   | 16        | 符号なし整数  |
| u32   | 32        | 符号なし整数  |
| u64   | 64        | 符号なし整数  |
| usize | ptr       | 符号なし整数  |

上記にある符号つきの整数型を総称して `{signed}` と表記する (i8 や isize も含まれる)。同様に符号なしの整数型を総称して `{unsigned}` と表記する。

`{signed}` の併合を iNN とおく。`{unsigned}` の併合を uNN とおく。(注意: `{signed}` は型の総称であって、それ自体は型ではない。一方、`iNN` は型であり、型検査の途中で使用する。)

TODO: i128, u128 を追加

## 浮動小数点数型

浮動小数点数の表現は IEEE-754 により定義される。

| 名前   | ビット幅   | 意味    |
|:------|----------:|:--------------|
| f32   | 32        | 浮動小数点数  |
| f64   | 64        | 浮動小数点数  |

これらの型を総称して `{float}` と表記する。`{float}` の和を fNN とおく。

TODO: f16, f128 を追加

## 文字型

文字型 `c8`, `c16`, `c32` は、それぞれ `u8`, `u16`, `u32` の newtype である。

| 名前   | ビット幅   | 意味    |
|:------|----------:|:----------------|
| c8    | 8         | UTF-8 コードユニット  |
| c16   | 16        | UTF-16 コードユニット |
| c32   | 32        | UTF-32 コードユニット |

これらの型を総称して `{char}` と表記する。`{char}` の和を cNN とおく。

注意: 文字型の値が所定のエンコーディングのコードユニットとして有効かどうかはコンパイル時にも実行時にも検査されないし、違反してもプログラムの誤りとはみなされない。文字型の配列が所定のエンコーディングの文字列として有効かどうかも同様に、違反しても誤りとはみなされない。

## ユニット型

`()` (unit) は型であり、値は定数 `()` に限られる。この値のサイズは 0 ビットである。

`()` を含めて、サイズが 0 ビットの型は **ゼロサイズ型** と総称する。

## bool 型

`bool` は型である。`bool` 型の値は、定数 `true`, `false` の2つに限られる。

`bool` 型は全順序を持ち、`false < true` が成り立つ。

`bool` 型は整数型と相互にキャストできて、次のように対応する。

| bool      | 整数  |
|:----------|:------|
| false     | 0     |
| true      | 1     |
| true      | 0, 1 以外の整数 |

## 特殊な型: unknown

*未実装*

`unknown` は型である。

T を型とするとき、`*T` は明示的に `*unknown` の部分型である。`*mut T` についても同様。また、逆向きのキャストも可能。

```
すべての式 e、型 T、型環境 Γ について次がすべて成り立つ:

    Γ |- e : *T =>
        e as *unknown : *unknown

    Γ |- e : *mut T =>
        e as *mut unknown : *mut unknown

    Γ |- e : *unknown =>
        e as *T : *T

    Γ |- e : *mut unknown =>
        e as *mut T : *mut T
```

備考: `*unknown` はC言語の `const void*` に相当し、`*mut unknown` は `void*` に相当する。

## 特殊な型: never

`!` (never) は型であり、値を持たない。

`!` 型の式を評価するとき、「評価が有限ステップで停止して何らかの値が得られる」ことはない。代わりに、無限ループに陥って停止しない、関数から return する、プログラム自体が終了する、などの現象が起こる。

なお、値を持たない型は `!` に限らない。例えば、enum 宣言 `enum MyNever {}` により定義される enum 型 `MyNever` も値を持たない。`!` を含めて、値を持たない型は **発散型** と総称する。

T を型とし、X を発散型とするとき、X は暗黙的に T の部分型である (`X <: T`)。特に、`! <: T`。

## 読み取り専用のポインタ型

T を型とする。`*const T` は読み取り専用のポインタ型である。`*T` は `*const T` に等しい。

型 T に関する部分型関係は共変 (covariant) に遺伝する。

## 可変なポインタ型

T を型とする。`*mut T` は可変なポインタ型である。

型 T に関する部分型関係は遺伝しない (invariant)。

## enum 型

enum 宣言 `enum T ...` は新しい型 T を導入する。これを enum 型と呼ぶ。

### バリアントの型

TBD

### enum 型の表現

すべてのバリアントが発散型なら、T も発散型である。(バリアントを持たない場合も発散型である。)

T がちょうど1つのバリアントからなり、そのバリアントがゼロサイズ型であるか、初期化式を持たない定数バリアントなら、T もゼロサイズ型である。

発散型でもゼロサイズ型でもない enum 型を **標準的な enum 型** と呼ぶ。以下、T は標準的とする。

標準的な enum 型にはタグと呼ばれる整数が定義される。

TODO: enum 型のタグの型や値、enum 型の値のサイズ、構築、分解について述べる

## struct 型

struct 宣言 `struct T ...` は新しい型 T を導入する。これを struct 型と呼ぶ。

## 参考

- C言語の算術型: [Arithmetic types](https://en.cppreference.com/w/c/language/arithmetic_types)
- C言語の標準ライブラリの型: [Type support](https://en.cppreference.com/w/c/types)
